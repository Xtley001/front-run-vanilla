# ============================================================
# FRONT RUN VANILLA - Makefile for GitHub Codespaces
# ============================================================

.PHONY: help build test bench paper backtest live clean format lint check watch install docs

# Default target
help:
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Front Run Vanilla - Development Commands     â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸ”¨ Building:"
	@echo "  make build       - Build in release mode"
	@echo "  make build-dev   - Build in debug mode"
	@echo ""
	@echo "ğŸ§ª Testing:"
	@echo "  make test        - Run all tests"
	@echo "  make bench       - Run benchmarks"
	@echo "  make check       - Run clippy checks"
	@echo "  make lint        - Run full lint"
	@echo ""
	@echo "ğŸ“ˆ Trading:"
	@echo "  make paper       - Run paper trader (safe)"
	@echo "  make backtest    - Run backtester"
	@echo "  make live        - Run live trader (âš ï¸  REAL MONEY)"
	@echo ""
	@echo "ğŸ”§ Development:"
	@echo "  make watch       - Auto-rebuild on changes"
	@echo "  make format      - Format code"
	@echo "  make clean       - Clean build artifacts"
	@echo "  make install     - Install dev tools"
	@echo ""
	@echo "ğŸ“– Documentation:"
	@echo "  make docs        - View documentation"
	@echo ""

# Build commands
build:
	@echo "ğŸ”¨ Building in release mode..."
	@cargo build --release

build-dev:
	@echo "ğŸ”¨ Building in debug mode..."
	@cargo build

# Testing
test:
	@echo "ğŸ§ª Running tests..."
	@cargo test --release

test-verbose:
	@echo "ğŸ§ª Running tests (verbose)..."
	@cargo test --release -- --nocapture

bench:
	@echo "âš¡ Running benchmarks..."
	@cargo bench
	@echo "ğŸ“Š View results: target/criterion/report/index.html"

# Code quality
check:
	@echo "ğŸ” Running clippy..."
	@cargo clippy -- -D warnings

lint:
	@echo "ğŸ” Running full lint..."
	@cargo clippy --all-targets --all-features -- -D warnings

format:
	@echo "âœ¨ Formatting code..."
	@cargo fmt

format-check:
	@echo "ğŸ” Checking format..."
	@cargo fmt -- --check

# Trading binaries
paper:
	@echo "ğŸ“ˆ Starting paper trader (no real money)..."
	@echo "âš ï¸  Press Ctrl+C to stop"
	@cargo run --release --bin paper_trader

backtest:
	@echo "ğŸ“Š Running backtest..."
	@cargo run --release --bin backtester -- --start 2024-01-01 --end 2024-12-31

live:
	@echo "âš ï¸  WARNING: LIVE TRADING MODE - REAL MONEY!"
	@echo "Press Ctrl+C within 5 seconds to cancel..."
	@sleep 5
	@cargo run --release --bin live_trader

# Development tools
watch:
	@echo "ğŸ‘€ Watching for changes..."
	@cargo watch -x 'build --release'

watch-test:
	@echo "ğŸ‘€ Watching and testing..."
	@cargo watch -x test

install:
	@echo "ğŸ“¦ Installing development tools..."
	@cargo install cargo-watch cargo-edit cargo-audit

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@cargo clean
	@rm -rf logs/*.log
	@rm -rf data/orderbook/* data/trades/* data/funding/*
	@echo "âœ“ Clean complete"

# Documentation
docs:
	@echo "ğŸ“– Opening documentation..."
	@cat README.md

# Setup
setup:
	@echo "ğŸš€ Running setup..."
	@bash setup.sh

# Environment check
env-check:
	@echo "ğŸ” Checking environment..."
	@if [ -f .env ]; then \
		echo "âœ“ .env file exists"; \
	else \
		echo "âœ— .env file missing - run: cp .env.example .env"; \
	fi
	@echo ""
	@echo "Rust version: $$(rustc --version)"
	@echo "Cargo version: $$(cargo --version)"

# Quick start
quickstart: env-check build test
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Ready to trade! Run: make paper               â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# CI/CD simulation
ci: format-check lint test
	@echo "âœ“ CI checks passed!"

# All checks before commit
pre-commit: format lint test
	@echo "âœ“ Pre-commit checks passed!"
